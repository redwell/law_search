# MVP要件定義書 (MVP_REQUIREMENTS.md)

## MVP概要

税法領域に特化した法律検索システムのMVP（最小実行可能プロダクト）を構築します。一般ユーザーが自然言語で質問し、税法に関する回答を得られるWebUIを提供します。

## 対象範囲

### 含まれる機能
- **税法データ**: e-Govからダウンロード可能な税法関連データ
- **WebUI**: ブラウザベースの質問応答インターフェース
- **ハイブリッド検索**: 全文検索・ベクトル検索・グラフ検索
- **RAGシステム**: 自然言語での回答生成
- **引用元表示**: 回答の根拠となる法律条文の表示

### 含まれない機能（次のステップ）
- 判例・通達データ
- 他プラットフォーム連携（LINE/Teams/Slack/Discord）
- ユーザー認証・アカウント管理
- 高度な分析・レポート機能
- 全法律領域（税法以外）

## 機能要件

### 1. データ管理機能

#### 1.1 データ取得
- **要件**: e-Govから税法関連のXMLデータを自動取得
- **対象データ**:
  - 所得税法
  - 法人税法
  - 消費税法
  - 相続税法
  - その他の税法（e-Govで提供されているもの）
- **更新頻度**: 月1回
- **データ形式**: XML（XSDスキーマ定義あり）

#### 1.2 データ処理
- **要件**: XMLデータの解析・正規化・構造化
- **処理内容**:
  - XMLパースとスキーマ検証
  - テキストの正規化・クリーニング
  - 法律間の参照関係の抽出
  - 埋め込み生成用のテキスト分割
- **出力**: ArangoDBに格納可能な形式

#### 1.3 埋め込み生成
- **要件**: 法律条文のベクトル表現を生成
- **モデル**: jinaai/jina-embeddings-v3
- **処理単位**: 条文単位（必要に応じて分割）
- **更新タイミング**: 新規データ取得時・モデル変更時

### 2. 検索機能

#### 2.1 全文検索
- **要件**: キーワードベースの高速検索
- **実装**: ArangoDBのAQL全文検索機能
- **対象**: 条文内容の全文検索
- **性能**: 平均1秒以内で結果返却

#### 2.2 ベクトル検索
- **要件**: 意味的類似性による検索
- **実装**: ArangoDBのベクトル検索機能
- **対象**: 埋め込みベクトルの類似検索
- **性能**: 平均1秒以内で結果返却

#### 2.3 グラフ検索
- **要件**: 関連条文・法律の検索
- **実装**: ArangoDBのグラフトラバーサル
- **対象**: 法律間・条文間の関係性
- **性能**: 平均1秒以内で結果返却

#### 2.4 ハイブリッド検索
- **要件**: 3つの検索手法を組み合わせた統合検索
- **実装**: 結果の統合・重み付け・ランキング
- **性能**: 平均3秒以内で結果返却

### 3. 質問応答機能

#### 3.1 質問理解
- **要件**: ユーザーの質問を解析・理解
- **機能**:
  - 質問の意図抽出
  - 関連する税法領域の特定
  - 検索クエリの生成
- **対応言語**: 日本語

#### 3.2 回答生成
- **要件**: 自然言語での回答生成
- **モデル**: ChatGPT API
- **機能**:
  - 一般ユーザー向けの分かりやすい説明
  - 引用元の明示
  - 関連情報の提供
- **回答形式**: テキスト + 引用元の法律条文

#### 3.3 引用元表示
- **要件**: 回答の根拠となる法律条文の表示
- **表示内容**:
  - 法律名
  - 条番号
  - 条文内容
  - 関連条文へのリンク

### 4. WebUI機能

#### 4.1 質問入力
- **要件**: 自然言語での質問入力
- **入力形式**: テキストエリア
- **文字数制限**: 500文字以内
- **入力支援**: プレースホルダー・ヘルプテキスト

#### 4.2 回答表示
- **要件**: 分かりやすい回答の表示
- **表示内容**:
  - 回答テキスト
  - 引用元の法律条文
  - 関連条文へのリンク
- **レイアウト**: レスポンシブデザイン

#### 4.3 関連情報表示
- **要件**: 関連する法律条文の表示
- **表示内容**:
  - 関連条文の一覧
  - 条文内容のプレビュー
  - 詳細表示へのリンク

## 非機能要件

### 1. パフォーマンス要件

#### 1.1 レスポンス時間
- **質問応答**: 平均3秒以内
- **検索**: 平均1秒以内
- **ページ表示**: 平均2秒以内

#### 1.2 スループット
- **同時ユーザー**: 10人
- **1日あたりの質問**: 100件
- **データ更新**: バッチ処理（非同期）

#### 1.3 可用性
- **稼働率**: 95%以上
- **ダウンタイム**: 月8時間以内

### 2. セキュリティ要件

#### 2.1 データ保護
- **暗号化**: 転送時・保存時の暗号化
- **アクセス制御**: 基本的なAPI認証
- **監査ログ**: アクセス・操作の記録

#### 2.2 プライバシー
- **個人情報**: 最小限の収集
- **ログ**: 個人を特定できない形式
- **データ保持**: 必要最小限の期間

### 3. 運用要件

#### 3.1 監視
- **システム監視**: CPU・メモリ・ディスク使用率
- **アプリケーション監視**: レスポンス時間・エラー率
- **ビジネス監視**: 質問数・回答精度

#### 3.2 バックアップ
- **データベース**: 日次バックアップ
- **設定ファイル**: バージョン管理
- **ログ**: 7日間保持

## 技術要件

### 1. 開発環境
- **OS**: macOS（開発者環境）
- **Python**: 3.11以上
- **パッケージ管理**: uv
- **バージョン管理**: Git + GitHub
- **IDE**: Cursor

### 2. 実行環境
- **OS**: Linux（本番環境）
- **コンテナ**: Docker + docker-compose
- **データベース**: ArangoDB 3.11以上
- **Webサーバー**: 未定（Nginx候補）

### 3. 外部サービス
- **AI API**: OpenAI ChatGPT API
- **埋め込みモデル**: jinaai/jina-embeddings-v3
- **データソース**: e-Gov XMLデータ

## データ要件

### 1. データ量
- **税法データ**: 約100MB（XML形式）
- **処理後データ**: 約500MB（ArangoDB形式）
- **埋め込みデータ**: 約1GB（ベクトル形式）

### 2. データ品質
- **完全性**: 99%以上
- **正確性**: 99%以上
- **一貫性**: スキーマ検証による保証

### 3. データ更新
- **頻度**: 月1回
- **方法**: 自動バッチ処理
- **検証**: 更新後のデータ品質チェック

## ユーザビリティ要件

### 1. 使いやすさ
- **学習コスト**: 5分以内で基本的な操作を習得
- **エラー処理**: 分かりやすいエラーメッセージ
- **ヘルプ**: 基本的なヘルプテキスト

### 2. アクセシビリティ
- **レスポンシブ**: モバイル・タブレット対応
- **ブラウザ対応**: Chrome・Firefox・Safari
- **文字サイズ**: 可読性を考慮したサイズ

### 3. 多言語対応
- **対応言語**: 日本語のみ（MVP段階）
- **文字エンコーディング**: UTF-8

## 制約事項

### 1. 技術的制約
- **ローカル環境**: 開発はローカル環境で実施
- **コスト**: 本番環境はコスト重視
- **複雑性**: シンプルな構成を維持

### 2. 時間的制約
- **開発期間**: 3ヶ月以内でMVP完成
- **リリース**: 段階的なリリース
- **テスト**: 十分なテスト期間を確保

### 3. リソース制約
- **開発者**: 1名（MVP段階）
- **予算**: 最小限のコスト
- **インフラ**: 基本的な構成

## 成功基準

### 1. 機能基準
- **質問応答精度**: 80%以上
- **引用元の正確性**: 95%以上
- **システム稼働率**: 95%以上

### 2. ユーザビリティ基準
- **ユーザー満足度**: 4.0/5.0以上
- **質問解決率**: 80%以上
- **エラー率**: 5%以下

### 3. 技術基準
- **レスポンス時間**: 要件を満たす
- **データ更新**: 正常に完了
- **セキュリティ**: 基本的な対策を実装

## リスクと対策

### 1. 技術リスク
- **ArangoDBの学習コスト**: 公式ドキュメントとコミュニティを活用
- **埋め込みモデルの性能**: 複数モデルでの比較検証
- **RAGシステムの複雑性**: 段階的な実装とテスト

### 2. データリスク
- **e-Govデータの変更**: 定期的な監視と自動更新
- **データ品質の問題**: 前処理での品質チェック
- **データ量の増大**: 効率的なインデックス設計

### 3. 運用リスク
- **コストの増大**: 定期的なコスト監視と最適化
- **パフォーマンスの劣化**: 継続的な監視とチューニング
- **セキュリティ**: 基本的なセキュリティ対策の実装

## 次のステップ

1. **詳細設計**: 各機能の詳細設計
2. **プロトタイプ**: コア機能のプロトタイプ実装
3. **テスト**: 機能テスト・性能テスト
4. **評価**: ユーザビリティテスト・性能評価
5. **改善**: フィードバックに基づく改善

---

*このドキュメントはリビングドキュメントです。MVPの開発進行に合わせて継続的に更新されます。*
